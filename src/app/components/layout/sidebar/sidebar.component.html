<aside
  class="fixed overflow-hidden static top-16 left-0 h-[calc(100vh-4rem)] mt-0 max-h-[calc(100vh-4rem)] shadow-xl backdrop-blur-sm z-10 flex flex-col transition-all duration-300 ease-in-out bg-gradient-to-b from-blue-500 to-indigo-300 pr-[2px] "
  [class.w-64]="isExpanded"
  [class.w-16]="!isExpanded"
>
  <div
    class="flex bg-gray-800 flex-col h-full w-full rounded-r-sm overflow-hidden"
  >
    <div
      class="flex items-center justify-center border-b-1 border-gray-500 justify-between p-0 flex-shrink-0"
    >
      @if(isExpanded){
      <div class="flex justify-center flex-1 items-center space-x-2">
        <span
          class="text-sm font-bold text-gray-400 bg-clip-text "

        >
          Menu
        </span>
      </div>
      }
      <button
        (click)="toggleSidebar()"
        class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-all duration-200"

        [attr.aria-label]="isExpanded ? 'Retrair menu' : 'Expandir menu'"
      >
        <ng-icon
          [name]="isExpanded ? 'heroXMark' : 'heroBars3'"
          size="18"
        ></ng-icon>
      </button>
    </div>

    <nav class="flex-1 p-2 space-y-1 overflow-y-auto custom-scrollbar">
      @for(item of menuItemsFiltered(); track item){
      <div class="space-y-1">
        <button
          (click)="handleMenuClick(item)"
          [class]="getMenuItemClasses(item)"
          [attr.aria-expanded]="item.children ? item.expanded : null"
        >
          <div class="flex items-center space-x-3 min-w-0">
            <ng-icon [name]="item.icon" size="20" class="flex-shrink-0"></ng-icon>
            @if(isExpanded){
            <span class="truncate font-medium text-sm">
              {{ item.label }}
            </span>
            }
          </div>

          @if(isExpanded && item.children){
          <ng-icon
            name="heroChevronDown"
            size="16"
            [class]="
              'flex-shrink-0 transition-transform duration-200 ' +
              (item.expanded ? 'rotate-180' : '')
            "
          >
          </ng-icon>
          }
        </button>

        @if(item.children && item.expanded){
        <div class="pb-1 space-y-1 overflow-hidden transition-all duration-300" [class.ml-2]="!isExpanded"  [class.ml-4]="isExpanded"  >
          @for(subItem of item.children; track subItem){
          <button
            (click)="navigateToRoute(subItem.route!)"
            [class]="getSubMenuItemClasses(subItem)"
          >
            <div class="flex items-center space-x-3 min-w-0">
              <ng-icon
                [name]="subItem.icon"
                size="16"
                class="flex-shrink-0"
              ></ng-icon>
              <span class="truncate text-sm">{{ subItem.label }}</span>
            </div>
          </button>
          }
        </div>
        }
      </div>
      }
    </nav>

    <div
      class="p-4 border-t border-slate-200/60 flex-shrink-0">
      @if(isExpanded){
      <div class="text-xs text-slate-500 text-center">
        Lab v1.0
      </div>
      } @if(!isExpanded){
      <div
        class="w-6 h-1 bg-slate-300 rounded mx-auto"
      ></div>
      }
    </div>
  </div>
</aside>
